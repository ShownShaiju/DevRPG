{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>DevRPG - Access Portal</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&amp;family=Press+Start+2P&amp;display=swap" rel="stylesheet"/>
<script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            devBlue: '#0d59f2',
            devDark: '#101622',
            devSurface: '#1a2234',
            devBorder: '#222f49',
            xpGold: '#fbbf24',
          },
          fontFamily: {
            sans: ['Space Grotesk', 'sans-serif'],
            gamer: ['"Press Start 2P"', 'cursive'],
          },
        }
      }
    }
  </script>
<style>
    @keyframes glow {
      0%, 100% { text-shadow: 0 0 10px rgba(13, 89, 242, 0.5); }
      50% { text-shadow: 0 0 20px rgba(13, 89, 242, 0.8); }
    }
    .logo-glow { animation: glow 3s ease-in-out infinite; }
    
    .grid-bg {
      background-image: linear-gradient(rgba(34, 47, 73, 0.5) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(34, 47, 73, 0.5) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    /* Form Transitions */
    .form-field {
        transition: all 0.3s ease-in-out;
        opacity: 1;
        max-height: 100px;
        overflow: hidden;
    }
    .form-field.hidden-field {
        opacity: 0;
        max-height: 0;
        margin: 0;
        padding: 0;
    }

    /* TOAST NOTIFICATION STYLES */
    #toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 50;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .toast {
        background: rgba(16, 22, 34, 0.95);
        border-left: 4px solid #0d59f2;
        color: white;
        padding: 16px 24px;
        border-radius: 4px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        transform: translateX(100%);
        transition: transform 0.3s ease-out;
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 300px;
        border: 1px solid rgba(255,255,255,0.1);
    }
    .toast.show { transform: translateX(0); }
    .toast.success { border-left-color: #fbbf24; } /* Gold for success */
    .toast.error { border-left-color: #ef4444; }   /* Red for error */
    .toast.info { border-left-color: #0d59f2; }    /* Blue for info */
</style>
</head>
<body class="bg-devDark text-gray-100 font-sans min-h-screen flex items-center justify-center">

<div id="toast-container"></div>

<div id="django-messages" style="display:none;">
    {% if messages %}
        {% for message in messages %}
            <div data-tag="{{ message.tags }}" data-text="{{ message }}"></div>
        {% endfor %}
    {% endif %}
</div>

<main class="w-full min-h-screen flex flex-col md:flex-row">
    
    <section class="w-full md:w-1/2 bg-devDark relative overflow-hidden flex flex-col items-center justify-center p-8 lg:p-16">
        <div class="absolute inset-0 grid-bg"></div>
        <div class="relative z-10 text-center">
            <h1 class="font-gamer text-4xl md:text-6xl text-devBlue logo-glow mb-8 tracking-tighter">DevRPG</h1>
            <p class="font-bold text-xl md:text-3xl max-w-md leading-relaxed">
                "Your career growth <span class="text-xpGold">starts</span> with a single step."
            </p>
        </div>
    </section>

    <section class="w-full md:w-1/2 bg-devSurface flex items-center justify-center p-8 lg:p-20 border-l border-devBorder">
        <div class="w-full max-w-md">
            
            <header class="mb-10">
                <h2 id="form-title" class="text-3xl font-bold uppercase tracking-wider text-white mb-2">Join the Guild</h2>
                <p id="form-subtitle" class="text-gray-400 text-sm">Create your player profile to start your quest.</p>
            </header>

            <form id="auth-form" method="POST" 
                  action="{% url 'register' %}" 
                  data-register-url="{% url 'register' %}" 
                  data-login-url="{% url 'login' %}" 
                  class="space-y-4">
                
                {% csrf_token %}

                <div id="field-username" class="group form-field">
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-2">Username</label>
                    <input type="text" id="input-username" name="username" placeholder="Player123" required
                           class="w-full bg-devDark border-devBorder rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-devBlue focus:border-devBlue outline-none transition-all">
                </div>

                <div class="group form-field">
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-2">Email Address</label>
                    <input type="email" name="email" placeholder="dev@guild.com" required
                           class="w-full bg-devDark border-devBorder rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-devBlue focus:border-devBlue outline-none transition-all">
                </div>

                <div class="group form-field">
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-2">Password</label>
                    <input type="password" name="password" placeholder="••••••••" required
                           class="w-full bg-devDark border-devBorder rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-devBlue focus:border-devBlue outline-none transition-all">
                </div>

                <div id="field-confirm" class="group form-field">
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-2">Confirm Password</label>
                    <input type="password" id="input-confirm" name="confirm-password" placeholder="••••••••" required
                           class="w-full bg-devDark border-devBorder rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-devBlue focus:border-devBlue outline-none transition-all">
                </div>

                <div class="pt-4">
                    <button type="submit" id="submit-btn" class="w-full bg-devBlue hover:bg-blue-600 text-white font-bold py-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] shadow-[0_0_15px_rgba(13,89,242,0.4)] uppercase tracking-widest text-sm">
                        Begin Quest
                    </button>
                </div>
            </form>

            <footer class="mt-8 text-center">
                <p class="text-gray-400 text-sm">
                    <span id="footer-text">Already a member?</span> 
                    <button onclick="toggleAuthMode()" id="toggle-btn" class="text-devBlue hover:text-blue-400 font-bold ml-1 transition-colors underline cursor-pointer">
                        Sign In
                    </button>
                </p>
            </footer>
        </div>
    </section>

</main>

<script>
    let isLoginMode = false;

    // 1. FORM TOGGLE LOGIC
    function toggleAuthMode() {
        const form = document.getElementById('auth-form');
        const title = document.getElementById('form-title');
        const subtitle = document.getElementById('form-subtitle');
        const submitBtn = document.getElementById('submit-btn');
        const footerText = document.getElementById('footer-text');
        const toggleBtn = document.getElementById('toggle-btn');
        
        const userField = document.getElementById('field-username');
        const confirmField = document.getElementById('field-confirm');
        const userInput = document.getElementById('input-username');
        const confirmInput = document.getElementById('input-confirm');

        const loginUrl = form.getAttribute('data-login-url');
        const registerUrl = form.getAttribute('data-register-url');

        isLoginMode = !isLoginMode;

        if (isLoginMode) {
            // SWITCH TO LOGIN
            title.innerText = "Welcome Back";
            subtitle.innerText = "System Ready. Enter credentials.";
            submitBtn.innerText = "Resume Quest";
            footerText.innerText = "New to the guild?";
            toggleBtn.innerText = "Create Account";
            form.action = loginUrl;
            
            userField.classList.add('hidden-field');
            confirmField.classList.add('hidden-field');
            userInput.removeAttribute('required');
            confirmInput.removeAttribute('required');

            // Update URL query param to reflect state (optional but nice)
            const url = new URL(window.location);
            url.searchParams.set('mode', 'login');
            window.history.pushState({}, '', url);

        } else {
            // SWITCH TO REGISTER
            title.innerText = "Join the Guild";
            subtitle.innerText = "Create your player profile to start.";
            submitBtn.innerText = "Begin Quest";
            footerText.innerText = "Already a member?";
            toggleBtn.innerText = "Sign In";
            form.action = registerUrl;

            userField.classList.remove('hidden-field');
            confirmField.classList.remove('hidden-field');
            userInput.setAttribute('required', '');
            confirmInput.setAttribute('required', '');

            const url = new URL(window.location);
            url.searchParams.delete('mode');
            window.history.pushState({}, '', url);
        }
    }

    // 2. TOAST NOTIFICATION LOGIC
    function showToast(message, tag) {
        const container = document.getElementById('toast-container');
        
        const toast = document.createElement('div');
        toast.className = `toast ${tag}`; // Adds class 'success', 'error', or 'info'
        
        // Icon logic
        let icon = 'Info';
        if (tag.includes('success')) icon = '✔';
        if (tag.includes('error')) icon = '✖';

        toast.innerHTML = `
            <span class="text-xl font-bold">${icon}</span>
            <span class="text-sm font-bold uppercase tracking-wide">${message}</span>
        `;
        
        container.appendChild(toast);

        // Animate In
        setTimeout(() => { toast.classList.add('show'); }, 100);

        // Remove after 3 seconds
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => { toast.remove(); }, 300);
        }, 3000);
    }

    // 3. ON PAGE LOAD
    document.addEventListener("DOMContentLoaded", () => {
        // A. Check URL for "?mode=login" (From Logout Redirect)
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('mode') === 'login') {
            toggleAuthMode();
        }

        // B. Check for Django Messages
        const messageDivs = document.querySelectorAll('#django-messages div');
        messageDivs.forEach(div => {
            const tag = div.getAttribute('data-tag');
            const text = div.getAttribute('data-text');
            showToast(text, tag);
        });
    });
</script>

</body>
</html>